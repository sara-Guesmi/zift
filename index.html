<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zift Dashboard - Komz Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .integration-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .panel-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #e8f5e8;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #2d7d32;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        select,
        input {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .iframe-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .komz-iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 8px;
            background: #f9f9f9;
            transition: opacity 0.3s ease;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .info-panel {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .info-panel h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .info-panel p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üöÄ Zift Dashboard</h1>
    </div>

    <div class="container">
        <div class="integration-panel">
            <div class="panel-header">
                <h2 class="panel-title">Komz Integration Portal</h2>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Connected</span>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="orgSelect">Organization:</label>
                    <select id="orgSelect">
                        <option value="org_123">Acme Corporation</option>
                        <option value="org_456">TechStart Inc</option>
                        <option value="org_789">Global Solutions</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="userEmail">User Email:</label>
                    <input type="email" id="userEmail" value="john.doe@example.com" placeholder="Enter user email">
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn" onclick="loadKomzIframe()">Load Komz Dashboard</button>
                </div>
            </div>

            <div class="iframe-container" style="position: relative;">
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loader"></div>
                </div>
                <iframe id="komzIframe" class="komz-iframe" src="about:blank" title="Komz Dashboard">
                </iframe>
            </div>

            <div class="info-panel">
                <h4>üîê How this integration works:</h4>
                <p>
                    Zift generates a secure JWT token containing the organization ID and user email,
                    then loads Komz in an iframe. Komz validates the token and automatically creates
                    or authenticates the user, displaying their personalized dashboard without requiring
                    separate login credentials.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Simulated JWT generation and iframe loading
        function generateJWT(orgId, userEmail) {
            // In real implementation, this would be done server-side
            const header = btoa(JSON.stringify({
                "alg": "HS256",
                "typ": "JWT"
            }));

            const payload = btoa(JSON.stringify({
                "org_id": orgId,
                "user_email": userEmail,
                "iat": Math.floor(Date.now() / 1000),
                "exp": Math.floor(Date.now() / 1000) + 3600 // 1 hour
            }));

            // In production, this would be properly signed with the secret key
            const signature = "simulated_signature_" + Math.random().toString(36).substring(7);

            return `${header}.${payload}.${signature}`;
        }

        function loadKomzIframe() {
            const orgId = document.getElementById('orgSelect').value;
            const userEmail = document.getElementById('userEmail').value;

            if (!userEmail) {
                alert('Please enter a user email');
                return;
            }

            // Show loading overlay
            document.getElementById('loadingOverlay').style.display = 'flex';

            // Generate JWT token
            const jwt = generateJWT(orgId, userEmail);

            // Construct Komz URL with JWT
            const komzBaseUrl = 'https://komz.tech/'; 
            const komzUrl = `${komzBaseUrl}/jwt-auth?token=eyJhbGciOiJBMjU2S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwidHlwIjoiSldUIiwiY3R5IjoiSldUIn0.Gvm1d9dhseHcVDfO713hnX_zogfEaJIpvku9q9NEuNfDeDM8sJb0nQ.npp2yl295IielVcAq8W8JQ.yBDrDSCdgABqQZ1F-ODC4zIoefnNROkcFZBKyRKwg5lmciwNvNPsmNKDIIUoL5C98iIBbAHlcj0Lsi9gycPWnRck9gXEJLin6oldfRYal5OWpkia7-tJw-33vnPip2KQDpZ-ErK3eouaeCwf1vwZYvX1biifyspBW70-mRf8gAw-t2c9gjFSSjcgpqX105C_1AZ8TyGHvkXQ36PYIkqhGUJblacJHcVBWA6LaHMEdswWxPoi3TLqwhFyo_Fnla9x91WJn91ZdhoQx17CoYo4zzr3zLjslnIyPwVTwOYsEGRBzcLdsbA2tkhi2OZDJmwHqOaEp6JPnYWZrzpUVMQcRcenyPkMPLxLEK_D1IZX4y7oeHY59-AkcsGLvJG1feCWFa2dF7QrrbG5Yt2lBCnKKdqb2uIlf38r1kya-aqqXWim0LMjnHTKQZhzkr1dDm0mFFL-W77hFzBQQg-ccifa0hG-CVxrv84P1k4nRNxMERM.TCEe1ROuL_3NJjEf-rKj9A"`;

            // Load iframe
            const iframe = document.getElementById('komzIframe');

            // Simulate loading delay
            setTimeout(() => {
                iframe.src = komzUrl;

                // Hide loading overlay after iframe loads
                iframe.onload = () => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                };

                // Handle load errors
                iframe.onerror = () => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    alert('Failed to load Komz dashboard. Please try again.');
                };
            }, 1000);
        }

        // Auto-load on page load with default values
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadKomzIframe, 1500);
        });

        // Handle iframe communication
        window.addEventListener('message', (event) => {
            // Verify origin in production
            if (event.origin !== 'https://komz.example.com') return;

            if (event.data.type === 'komz_loaded') {
                console.log('Komz dashboard loaded successfully');
            } else if (event.data.type === 'komz_error') {
                console.error('Komz error:', event.data.message);
                alert('Error loading Komz: ' + event.data.message);
            }
        });
    </script>
</body>

</html>