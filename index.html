<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zift Dashboard - Komz Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .integration-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .panel-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #e8f5e8;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #2d7d32;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        select,
        input {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .iframe-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        .komz-iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 8px;
            background: #f9f9f9;
            transition: opacity 0.3s ease;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .info-panel {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .info-panel h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .info-panel p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .debug-panel {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .debug-panel h4 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üöÄ Zift Dashboard</h1>
    </div>

    <div class="container">
        <div class="integration-panel">
            <div class="panel-header">
                <h2 class="panel-title">Komz Integration Portal</h2>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Connected</span>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="orgSelect">Organization:</label>
                    <select id="orgSelect">
                        <option value="org_123">Acme Corporation</option>
                        <option value="org_456">TechStart Inc</option>
                        <option value="org_789">Global Solutions</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="userEmail">User Email:</label>
                    <input type="email" id="userEmail" value="john.doe@example.com" placeholder="Enter user email">
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn" onclick="loadKomzIframe()">Load Komz Dashboard</button>
                </div>
            </div>

            <div class="iframe-container">
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loader"></div>
                </div>
                <iframe id="komzIframe" class="komz-iframe" src="about:blank" title="Komz Dashboard">
                </iframe>
            </div>

            <div class="info-panel">
                <h4>üîê How this integration works:</h4>
                <p>
                    Zift generates a secure JWT token containing the organization ID and user email,
                    then loads Komz in an iframe. Komz validates the token and automatically 
                 authenticates the user, displaying their personalized dashboard without requiring
                    separate login credentials.
                </p>
            </div>

        
        </div>
    </div>

    <script>
        // Debug logging
        function updateDebug(status, url = '', error = '') {
            document.getElementById('debugStatus').textContent = status;
            if (url) document.getElementById('debugUrl').textContent = url;
            if (error) document.getElementById('debugError').textContent = error;
        }

        // Simulated JWT generation
        function generateJWT(orgId, userEmail) {
            // In real implementation, this would be done server-side
            const header = btoa(JSON.stringify({
                "alg": "HS256",
                "typ": "JWT"
            }));

            const payload = btoa(JSON.stringify({
                "org_id": orgId,
                "user_email": userEmail,
                "iat": Math.floor(Date.now() / 1000),
                "exp": Math.floor(Date.now() / 1000) + 3600 // 1 hour
            }));

            // In production, this would be properly signed with the secret key
            const signature = "simulated_signature_" + Math.random().toString(36).substring(7);

            return `${header}.${payload}.${signature}`;
        }

        function loadKomzIframe() {
            const orgId = document.getElementById('orgSelect').value;
            const userEmail = document.getElementById('userEmail').value;

            if (!userEmail) {
                alert('Please enter a user email');
                return;
            }

            updateDebug('Loading...', '', '');

            document.getElementById('loadingOverlay').style.display = 'flex';

            const jwt = 'eyJhbGciOiJBMjU2S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwidHlwIjoiSldUIiwiY3R5IjoiSldUIn0.81VJKWwnTOfIatMSGUAOnMkZ8Y0EvggW9L8TrUcV1voK0MmaxNOpJQ.7wHNZWL2s8GyNwvCMqxdyA.WGv2_WeatNQua9445DxD6wN8I0y0HyZehEc3gdduqGBI4wUTWs4MT_vF4yOlo99dKS_coZFVw8tIaZSHcz5OkolGA4R1FNzbmvE_F-XrQqWcMSsWapCnz3a8wpV4I4RImk3P9-aQFm2ImX5zWwwsrLtOs5X3qgd-5x0P9JkD_3mqgRE14JHR-dpb3gt1TpQMzNqBuY36teR6R3XsCXuKe9NBXphrTWziZ3_yJlx-1h8YT07X9wpM45BBZ8GtkweoObRKdnLkvdHbjPryEkP_GakhluAUPDvelEkU0XP_VwrhH1y1n4DJKwW09YFMiN04iEcRD3M3NoLtBctflzUdWVygfc4y85yLwmnrAA_5ax_6VZ-6KedVAULFTtdddkIDDR3NuuHkau2Jq9TxTPQ1kqi5F8CJwPA4mbP6ElKUeOBIisprDH3e1hXS3NjmkLIodpygo2XV2fhfPdE91-yJenLjdwlKQZyrjZ62riRCfyA.eq60-SXULKc4Lab-cL-luA'

            const komzBaseUrl = 'http://localhost:3000'; 
            const komzUrl = `${komzBaseUrl}/jwt-auth?token=${encodeURIComponent(jwt)}`;

            updateDebug('Connecting...', komzUrl, '');

            // Load iframe
            const iframe = document.getElementById('komzIframe');

            iframe.onload = () => {
                updateDebug('Loaded', komzUrl, '');
                document.getElementById('loadingOverlay').style.display = 'none';
            };

            iframe.onerror = (error) => {
                updateDebug('Error', komzUrl, error.toString());
                document.getElementById('loadingOverlay').style.display = 'none';
                alert('Failed to load Komz dashboard. Please check console for details.');
            };

            try {
                iframe.src = komzUrl;
            } catch (error) {
                updateDebug('Error', komzUrl, error.toString());
                document.getElementById('loadingOverlay').style.display = 'none';
                alert('Error loading iframe: ' + error.message);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadKomzIframe, 1500);
        });

        // Handle iframe communication
        window.addEventListener('message', (event) => {
            console.log('Received message from iframe:', event);

            // In production, verify origin
            // if (event.origin !== 'http://localhost:3000') return;

            if (event.data.type === 'komz_loaded') {
                console.log('Komz dashboard loaded successfully');
                updateDebug('Success', event.data.url || '', '');
            } else if (event.data.type === 'komz_error') {
                console.error('Komz error:', event.data.message);
                updateDebug('Error', '', event.data.message);
                alert('Error loading Komz: ' + event.data.message);
            }
        });

        // Log any console errors
        window.addEventListener('error', (event) => {
            console.error('Page error:', event.error);
            updateDebug('Page Error', '', event.error?.message || event.message);
        });
    </script>
</body>

</html>